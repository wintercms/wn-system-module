if(void 0===window.jQuery)throw new Error("The jQuery library is not loaded. The Winter CMS framework cannot be initialized.");if(void 0!==window.jQuery.request)throw new Error("The Winter CMS framework is already loaded.");!function($){"use strict";var Request=function(element,handler,options){var $el=this.$el=$(element);if(this.options=options||{},void 0===handler)throw new Error("The request handler name is not specified.");if(!handler.match(/^(?:\w+\:{2})?on*/))throw new Error('Invalid handler name. The correct handler name format is: "onEvent".');var $form=options.form?$(options.form):$el.closest("form"),$triggerEl=$form.length?$form:$el,context={handler:handler,options:options};if(void 0!==options.browserValidate&&"function"==typeof document.createElement("input").reportValidity&&$form&&$form[0]&&!$form[0].checkValidity())return $form[0].reportValidity(),!1;$el.trigger("ajaxSetup",[context]);var _event=jQuery.Event("oc.beforeRequest");if($triggerEl.trigger(_event,context),!_event.isDefaultPrevented()){var loading=void 0!==options.loading?options.loading:null,url=void 0!==options.url?options.url:window.location.href,isRedirect=void 0!==options.redirect&&options.redirect.length,useFlash=void 0!==options.flash,useFiles=void 0!==options.files;useFiles&&"undefined"==typeof FormData&&(console.warn("This browser does not support file uploads via FormData"),useFiles=!1),"string"==$.type(loading)&&(loading=$(loading));var requestHeaders={"X-WINTER-REQUEST-HANDLER":handler,"X-WINTER-REQUEST-PARTIALS":this.extractPartials(options.update)};useFlash&&(requestHeaders["X-WINTER-REQUEST-FLASH"]=1);var csrfToken=getXSRFToken();csrfToken&&(requestHeaders["X-XSRF-TOKEN"]=csrfToken);var requestData,inputName,data={};$.each($el.parents("[data-request-data]").toArray().reverse(),(function(){$.extend(data,paramToObj("data-request-data",$(this).data("request-data")))})),$el.is(":input")&&!$form.length&&(inputName=$el.attr("name"),void 0!==inputName&&void 0===options.data[inputName]&&(options.data[inputName]=$el.val())),void 0===options.data||$.isEmptyObject(options.data)||$.extend(data,options.data);var requestParentData=$form.getRequestParentData();useFiles?(requestData=new FormData,$.each(requestParentData,(function(e){requestData.append(e,this)})),$el.is(":file")&&inputName&&($.each($el.prop("files"),(function(){requestData.append(inputName,this)})),delete data[inputName]),$.each(data,(function(e){"undefined"!=typeof Blob&&this instanceof Blob&&this.filename?requestData.append(e,this,this.filename):requestData.append(e,this)}))):requestData=[$.param(requestParentData),$.param(data)].filter(Boolean).join("&");var requestOptions={url:url,crossDomain:!1,global:options.ajaxGlobal,context:context,headers:requestHeaders,success:function(data,textStatus,jqXHR){if(!1!==this.options.beforeUpdate.apply(this,[data,textStatus,jqXHR])&&(!options.evalBeforeUpdate||!1!==eval("(function($el, context, data, textStatus, jqXHR) {"+options.evalBeforeUpdate+"}.call($el.get(0), $el, context, data, textStatus, jqXHR))"))){var _event=jQuery.Event("ajaxBeforeUpdate");if($triggerEl.trigger(_event,[context,data,textStatus,jqXHR]),!_event.isDefaultPrevented()){useFlash&&data.X_WINTER_FLASH_MESSAGES&&$.each(data.X_WINTER_FLASH_MESSAGES,(function(e,t){requestOptions.handleFlashMessage(t,e)}));var updatePromise=requestOptions.handleUpdateResponse(data,textStatus,jqXHR);return updatePromise.done((function(){$triggerEl.trigger("ajaxSuccess",[context,data,textStatus,jqXHR]),options.evalSuccess&&eval("(function($el, context, data, textStatus, jqXHR) {"+options.evalSuccess+"}.call($el.get(0), $el, context, data, textStatus, jqXHR))")})),updatePromise}}},error:function(jqXHR,textStatus,errorThrown){var errorMsg,updatePromise=$.Deferred();if(!(void 0!==window.ocUnloading&&window.ocUnloading||"abort"==errorThrown))return isRedirect=!1,options.redirect=null,406==jqXHR.status&&jqXHR.responseJSON?(errorMsg=jqXHR.responseJSON.X_WINTER_ERROR_MESSAGE,updatePromise=requestOptions.handleUpdateResponse(jqXHR.responseJSON,textStatus,jqXHR)):(errorMsg=jqXHR.responseText?jqXHR.responseText:jqXHR.statusText,updatePromise.resolve()),updatePromise.done((function(){$el.data("error-message",errorMsg);var _event=jQuery.Event("ajaxError");$triggerEl.trigger(_event,[context,errorMsg,textStatus,jqXHR]),_event.isDefaultPrevented()||options.evalError&&!1===eval("(function($el, context, errorMsg, textStatus, jqXHR) {"+options.evalError+"}.call($el.get(0), $el, context, errorMsg, textStatus, jqXHR))")||requestOptions.handleErrorMessage(errorMsg)})),updatePromise},complete:function(data,textStatus,jqXHR){$triggerEl.trigger("ajaxComplete",[context,data,textStatus,jqXHR]),options.evalComplete&&eval("(function($el, context, data, textStatus, jqXHR) {"+options.evalComplete+"}.call($el.get(0), $el, context, data, textStatus, jqXHR))")},handleConfirmMessage:function(e){var t=jQuery.Event("ajaxConfirmMessage");return t.promise=$.Deferred(),void 0!==$(window).triggerHandler(t,[e])?(t.promise.done((function(){options.confirm=null,new Request(element,handler,options)})),!1):t.isDefaultPrevented()?void 0:e?confirm(e):void 0},handleErrorMessage:function(e){var t=jQuery.Event("ajaxErrorMessage");$(window).trigger(t,[e]),t.isDefaultPrevented()||e&&alert(e)},handleValidationMessage:function(e,t){$triggerEl.trigger("ajaxValidation",[context,e,t]);var a=!0;$.each(t,(function(e,t){e=e.replace(/\.(\w+)/g,"[$1]");var r=$form.find('[name="'+e+'"], [name="'+e+'[]"], [name$="['+e+']"], [name$="['+e+'][]"]').filter(":enabled").first();if(r.length>0){var n=jQuery.Event("ajaxInvalidField");$(window).trigger(n,[r.get(0),e,t,a]),a&&(n.isDefaultPrevented()||r.focus(),a=!1)}}))},handleFlashMessage:function(e,t){},handleRedirectResponse:function(e){$(window).one("popstate",(function(){$el.trigger("ajaxRedirected")})),window.location.assign(e)},handleUpdateResponse:function(e,t,a){var r=$.Deferred().done((function(){for(var r in e){var n=options.update[r]?options.update[r]:r;"string"==$.type(n)&&"@"==n.charAt(0)?$(n.substring(1)).append(e[r]).trigger("ajaxUpdate",[context,e,t,a]):"string"==$.type(n)&&"^"==n.charAt(0)?$(n.substring(1)).prepend(e[r]).trigger("ajaxUpdate",[context,e,t,a]):"string"!=$.type(n)||"#"!=n.charAt(0)&&"."!=n.charAt(0)||($(n).trigger("ajaxBeforeReplace"),$(n).html(e[r]).trigger("ajaxUpdate",[context,e,t,a]))}setTimeout((function(){$(window).trigger("ajaxUpdateComplete",[context,e,t,a]).trigger("resize")}),0)}));return e.X_WINTER_REDIRECT&&(options.redirect=e.X_WINTER_REDIRECT,isRedirect=!0),isRedirect&&requestOptions.handleRedirectResponse(options.redirect),e.X_WINTER_ERROR_FIELDS&&requestOptions.handleValidationMessage(e.X_WINTER_ERROR_MESSAGE,e.X_WINTER_ERROR_FIELDS),e.X_WINTER_ASSETS?assetManager.load(e.X_WINTER_ASSETS,$.proxy(r.resolve,r)):r.resolve(),r}};if(useFiles&&(requestOptions.processData=requestOptions.contentType=!1),context.success=requestOptions.success,context.error=requestOptions.error,context.complete=requestOptions.complete,requestOptions=$.extend(requestOptions,options),requestOptions.data=requestData,!options.confirm||requestOptions.handleConfirmMessage(options.confirm))return loading&&loading.show(),$(window).trigger("ajaxBeforeSend",[context]),$el.trigger("ajaxPromise",[context]),$.ajax(requestOptions).fail((function(e,t,a){isRedirect||$el.trigger("ajaxFail",[context,t,e]),loading&&loading.hide()})).done((function(e,t,a){isRedirect||$el.trigger("ajaxDone",[context,e,t,a]),loading&&loading.hide()})).always((function(e,t,a){$el.trigger("ajaxAlways",[context,e,t,a])}))}};Request.DEFAULTS={update:{},type:"POST",beforeUpdate:function(e,t,a){},evalBeforeUpdate:null,evalSuccess:null,evalError:null,evalComplete:null,ajaxGlobal:!1},Request.prototype.extractPartials=function(e){var t=[];for(var a in e)t.push(a);return t.join("&")};var old=$.fn.request;function paramToObj(e,t){if(void 0===t&&(t=""),"object"==typeof t)return t;try{return ocJSON("{"+t+"}")}catch(t){throw new Error("Error parsing the "+e+" attribute value. "+t)}}function formDataToObj(e){var t={};for(const a of e.entries()){const e=a[0],r=a[1];Reflect.has(t,e)&&e.includes("[]")?(Array.isArray(t[e])||(t[e]=[t[e]]),t[e].push(r)):t[e]=r}return t}function getXSRFToken(){var e=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),a=0;a<t.length;a++){var r=jQuery.trim(t[a]);if("XSRF-TOKEN="==r.substring(0,11)){e=decodeURIComponent(r.substring(11));break}}return e}$.fn.request=function(e,t){var a=$(this).first(),r={evalBeforeUpdate:a.data("request-before-update"),evalSuccess:a.data("request-success"),evalError:a.data("request-error"),evalComplete:a.data("request-complete"),ajaxGlobal:a.data("request-ajax-global"),confirm:a.data("request-confirm"),redirect:a.data("request-redirect"),loading:a.data("request-loading"),flash:a.data("request-flash"),files:a.data("request-files"),browserValidate:a.data("browser-validate"),form:a.data("request-form"),url:a.data("request-url"),update:paramToObj("data-request-update",a.data("request-update")),data:paramToObj("data-request-data",a.data("request-data"))};e||(e=a.data("request"));var n=$.extend(!0,{},Request.DEFAULTS,r,"object"==typeof t&&t);return new Request(a,e,n)},$.fn.request.Constructor=Request,$.request=function(e,t){return $(document).request(e,t)},$.fn.request.noConflict=function(){return $.fn.request=old,this},$.fn.getRequestParentData=function(){var e=$(this).first(),t=[formDataToObj(new FormData(e.get(0)))],a={},r=function(e){if(e.length&&e.data("request-parent")){var a=$(e.data("request-parent"));if(a.length){var n={};$.each(a.parents("[data-request-data]").toArray().reverse(),(function(){$.extend(n,paramToObj("data-request-data",$(this).data("request-data")))})),a.is("[data-request-data]")&&$.extend(n,paramToObj("data-request-data",a.data("request-data")));var o=a.closest("form");o.length&&(t.push($.extend(formDataToObj(new FormData(o.get(0))),n)),r(o))}}};return r(e),t.reverse().forEach((function(e){$.extend(a,e)})),a},$(document).on("change","select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]",(function(){$(this).request()})),$(document).on("click","a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]",(function(e){if(e.preventDefault(),$(this).request(),$(this).is("[type=submit]"))return!1})),$(document).on("keydown","input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]",(function(e){if("Enter"===e.key)return void 0!==this.dataTrackInputTimer&&window.clearTimeout(this.dataTrackInputTimer),$(this).request(),!1})),$(document).on("input","input[data-request][data-track-input]",(function(e){var t=$(this),a=t.data("oc.lastvalue");if(t.is("[type=email],[type=number],[type=password],[type=search],[type=text]")&&(void 0===a||a!=this.value)){t.data("oc.lastvalue",this.value),void 0!==this.dataTrackInputTimer&&window.clearTimeout(this.dataTrackInputTimer);var r=$(this).data("track-input");r||(r=300);var n=this;this.dataTrackInputTimer=window.setTimeout((function(){n.lastDataTrackInputRequest&&n.lastDataTrackInputRequest.abort(),n.lastDataTrackInputRequest=$(n).request()}),r)}})),$(document).on("submit","[data-request]",(function(){return $(this).request(),!1})),$(window).on("beforeunload",(function(){window.ocUnloading=!0})),$(document).ready((function(){$(document).trigger("render")})),$(window).on("ajaxUpdateComplete",(function(){$(document).trigger("render")})),$.fn.render=function(e){$(document).on("render",e)}}(window.jQuery),function(e){"use strict";function t(e,t,a){for(var r="",n=t;n<e.length;n++){if(a&&a===e[n])return r;if(!a&&(" "===e[n]||":"===e[n]))return r;r+=e[n],"\\"===e[n]&&n+1<e.length&&(r+=e[n+1],n++)}throw new Error("Broken JSON syntax near "+r)}function a(e,t){if('"'===e[t]||"'"===e[t]){for(var a=e[t],r=t+1;r<e.length;r++)if("\\"===e[r])a+=e[r],r+1<e.length&&(a+=e[r+1]),r++;else{if(e[r]===e[t])return{originLength:(a+=e[t]).length,body:a};a+=e[r]}throw new Error("Broken JSON string body near "+a)}if("t"===e[t]){if(e.indexOf("true",t)===t)return{originLength:"true".length,body:"true"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("f"===e[t]){if(e.indexOf("f",t)===t)return{originLength:"false".length,body:"false"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("n"===e[t]){if(e.indexOf("null",t)===t)return{originLength:"null".length,body:"null"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("-"===e[t]||"+"===e[t]||"."===e[t]||e[t]>="0"&&e[t]<="9"){for(a="",r=t;r<e.length;r++){if(!("-"===e[r]||"+"===e[r]||"."===e[r]||e[r]>="0"&&e[r]<="9"))return{originLength:a.length,body:a};a+=e[r]}throw new Error("Broken JSON number body near "+a)}if("{"===e[t]||"["===e[t]){var n=[e[t]];for(a=e[t],r=t+1;r<e.length;r++){if(a+=e[r],"\\"===e[r])r+1<e.length&&(a+=e[r+1]),r++;else if('"'===e[r])'"'===n[n.length-1]?n.pop():"'"!==n[n.length-1]&&n.push(e[r]);else if("'"===e[r])"'"===n[n.length-1]?n.pop():'"'!==n[n.length-1]&&n.push(e[r]);else if('"'!==n[n.length-1]&&"'"!==n[n.length-1])if("{"===e[r])n.push("{");else if("}"===e[r]){if("{"!==n[n.length-1])throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+a);n.pop()}else if("["===e[r])n.push("[");else if("]"===e[r]){if("["!==n[n.length-1])throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+a);n.pop()}if(!n.length)return{originLength:r-t,body:a}}throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+a)}throw new Error("Broken JSON body near "+e.substr(t-5>=0?t-5:0,50))}function r(e){return" "===e||"\n"===e||"\t"===e}function n(e){if(!(e=e.trim()).length)throw new Error("Broken JSON object.");for(var o="";e&&","===e[0];)e=e.substr(1);if('"'===e[0]||"'"===e[0]){if(e[e.length-1]!==e[0])throw new Error("Invalid string JSON object.");for(var i='"',s=1;s<e.length;s++)if("\\"===e[s])"'"===e[s+1]||(i+=e[s]),i+=e[s+1],s++;else{if(e[s]===e[0])return i+='"';'"'===e[s]?i+='\\"':i+=e[s]}throw new Error("Invalid string JSON object.")}if("true"===e||"false"===e)return e;if("null"===e)return"null";var d,u=parseFloat(e);if(!isNaN(u))return u.toString();if("{"===e[0]){var l="needKey";for(o="{",s=1;s<e.length;s++){if(!r(e[s]))if("needKey"!==l||'"'!==e[s]&&"'"!==e[s]){if("needKey"===l&&("\\"!==(d=e[s])[0]&&(d[0]>="a"&&d[0]<="z"||d[0]>="A"&&d[0]<="Z"||"_"===d[0]||d[0]>="0"&&d[0]<="9"||"$"===d[0]||d.charCodeAt(0)>255))){var c;o+='"',o+=c=t(e,s),o+='"',s+=c.length-1,l="afterKey"}else if("afterKey"===l&&":"===e[s])o+=":",l=":";else if(":"===l){s=s+(i=a(e,s)).originLength-1,o+=n(i.body),l="afterBody"}else if("afterBody"===l||"needKey"===l){for(var f=s;","===e[f]||r(e[f]);)f++;if("}"===e[f]&&f===e.length-1){for(;","===o[o.length-1];)o=o.substr(0,o.length-1);return o+="}"}f!==s&&"{"!==o&&(o+=",",l="needKey",s=f-1)}}else o+='"'+(c=t(e,s+1,e[s]))+'"',s+=c.length,s+=1,l="afterKey"}throw new Error("Broken JSON object near "+o)}if("["===e[0]){for(o="[",l="needBody",s=1;s<e.length;s++)if(" "!==e[s]&&"\n"!==e[s]&&"\t"!==e[s])if("needBody"===l){if(","===e[s]){o+="null,";continue}if("]"===e[s]&&s===e.length-1)return","===o[o.length-1]&&(o=o.substr(0,o.length-1)),o+="]";s=s+(i=a(e,s)).originLength-1,o+=n(i.body),l="afterBody"}else if("afterBody"===l)if(","===e[s])for(o+=",",l="needBody";","===e[s+1]||r(e[s+1]);)","===e[s+1]&&(o+="null,"),s++;else if("]"===e[s]&&s===e.length-1)return o+="]";throw new Error("Broken JSON array near "+o)}}e.ocJSON=function(e){var t=n(e);return JSON.parse(t)}}(window),function(e){"use strict";function t(e){var t=$($.parseHTML("<div>"+e+"</div>",null,!1));return t.find("*").each((function(){var e;e=this,$.each(e.attributes,(function(){var t=this.name,a=this.value;0!=t.indexOf("on")&&0!=a.indexOf("javascript:")||$(e).removeAttr(t)}))})),t.html()}e.ocSanitize=function(e){return t(e)}}(window),function(e){"use strict";void 0===e.wn&&(e.wn={}),void 0===e.oc&&(e.oc=e.wn);var t="wn-loading";e(document).on("ajaxSetup","[data-request][data-request-flash]",(function(t,a){a.options.handleErrorMessage=function(t){e.wn.flashMsg({text:t,class:"error"})},a.options.handleFlashMessage=function(t,a){e.wn.flashMsg({text:t,class:a})}})),e(document).on("ajaxValidation","[data-request][data-request-validate]",(function(t,a,r,n){var o,i=e(this).closest("form"),s=e("[data-validate-error]",i),d=[];if(e.each(n,(function(t,a){o=e('[data-validate-for="'+t+'"]',i),d=e.merge(d,a),o.length&&(o.text().length&&1!=o.data("emptyMode")||o.data("emptyMode",!0).text(a.join(", ")),o.addClass("visible"))})),s.length&&(s=e("[data-validate-error]",i)),s.length){var u=e("[data-message]",s);if(s.addClass("visible"),u.length){var l=u.first();e.each(d,(function(e,t){l.clone().text(t).insertAfter(l)})),u.remove()}else s.text(r)}i.one("ajaxError",(function(e){e.preventDefault()}))})),e(document).on("ajaxPromise","[data-request][data-request-validate]",(function(){var t=e(this).closest("form");e("[data-validate-for]",t).removeClass("visible"),e("[data-validate-error]",t).removeClass("visible")})),e(document).on("ajaxPromise","[data-request]",(function(){var a=e(this);void 0!==a.data("attach-loading")&&a.addClass(t).prop("disabled",!0),a.is("form")&&e("[data-attach-loading]",a).addClass(t).prop("disabled",!0)})).on("ajaxFail ajaxDone ajaxRedirected","[data-request]",(function(){var a=e(this);void 0!==a.data("attach-loading")&&a.removeClass(t).prop("disabled",!1),a.is("form")&&e("[data-attach-loading]",a).removeClass(t).prop("disabled",!1)}));var a=function(){var t=this;this.counter=0,this.indicator=e("<div/>").addClass("stripe-loading-indicator loaded").append(e("<div />").addClass("stripe")).append(e("<div />").addClass("stripe-loaded")),this.stripe=this.indicator.find(".stripe"),e(document).ready((function(){e(document.body).append(t.indicator)}))};a.prototype.show=function(){this.counter++,this.stripe.after(this.stripe=this.stripe.clone()).remove(),this.counter>1||(this.indicator.removeClass("loaded"),e(document.body).addClass("wn-loading"))},a.prototype.hide=function(t){this.counter--,void 0!==t&&t&&(this.counter=0),this.counter<=0&&(this.indicator.addClass("loaded"),e(document.body).removeClass("wn-loading"))},e.wn.stripeLoadIndicator=new a,e(document).on("ajaxPromise","[data-request]",(function(t){t.stopPropagation(),e.wn.stripeLoadIndicator.show();var a=e(this);e(window).one("ajaxUpdateComplete",(function(){0===a.closest("html").length&&e.wn.stripeLoadIndicator.hide()}))})).on("ajaxFail ajaxDone ajaxRedirected","[data-request]",(function(t){t.stopPropagation(),e.wn.stripeLoadIndicator.hide()}));var r=function(t,a){t=e.extend({},r.DEFAULTS,t);var n=e(a);e("body > p.flash-message").remove(),0==n.length&&(n=e("<p />").addClass(t.class).html(t.text)),n.addClass("flash-message fade").attr("data-control",null).on("click","button",s).on("click",s).append('<button type="button" class="close" aria-hidden="true">&times;</button>'),e(document.body).append(n),setTimeout((function(){n.addClass("in")}),100);var o=window.setTimeout(s,1e3*t.interval);function i(){n.remove()}function s(){window.clearInterval(o),n.removeClass("in"),e.support.transition&&n.hasClass("fade")?n.one(e.support.transition.end,i).emulateTransitionEnd(500):i()}};r.DEFAULTS={class:"success",text:"Default text",interval:5},void 0===e.wn&&(e.wn={}),void 0===e.oc&&(e.oc=e.wn),e.wn.flashMsg=r,e(document).render((function(){e("[data-control=flash-message]").each((function(){e.wn.flashMsg(e(this).data(),this)}))}))}(window.jQuery);
