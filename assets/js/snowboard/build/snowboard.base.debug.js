"use strict";(self.webpackChunk_wintercms_system=self.webpackChunk_wintercms_system||[]).push([[450],{3672:function(t,e,n){n.d(e,{Z:function(){return f}});n(6886);class i{constructor(t){this.snowboard=t}dependencies(){return[]}listens(){return{}}destructor(){this.detach(),delete this.snowboard}}class s extends i{}class r{constructor(t,e,n){this.name=t,this.snowboard=e,this.instance=n,this.instances=[],this.singleton=n.prototype instanceof s,this.mocks={},this.originalFunctions={}}hasMethod(t){return!this.isFunction()&&"function"==typeof this.instance.prototype[t]}callMethod(){if(this.isFunction())return null;for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e,s=i.shift();return this.instance.prototype[s](i)}getInstance(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(this.isFunction())return this.instance(...n);if(!this.dependenciesFulfilled()){const t=this.getDependencies().filter((t=>!this.snowboard.getPluginNames().includes(t)));throw new Error('The "'.concat(this.name,'" plugin requires the following plugins: ').concat(t.join(", ")))}if(this.isSingleton())return 0===this.instances.length&&this.initialiseSingleton(),Object.keys(this.mocks).length>0&&(Object.entries(this.originalFunctions).forEach((t=>{const[e,n]=t;this.instances[0][e]=n})),Object.entries(this.mocks).forEach((e=>{const[n,i]=e;this.instances[0][n]=function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return i(t,...n)}}))),this.instances[0];Object.keys(this.mocks).length>0&&(Object.entries(this.originalFunctions).forEach((t=>{const[e,n]=t;this.instance.prototype[e]=n})),Object.entries(this.mocks).forEach((e=>{const[n,i]=e;this.instance.prototype[n]=function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return i(t,...n)}})));const s=new this.instance(this.snowboard,...n);return s.detach=()=>this.instances.splice(this.instances.indexOf(s),1),this.instances.push(s),s}getInstances(){return this.isFunction()?[]:this.instances}isFunction(){return"function"==typeof this.instance&&this.instance.prototype instanceof i==!1}isSingleton(){return this.instance.prototype instanceof s==!0}initialiseSingleton(){if(!this.isSingleton())return;const t=new this.instance(this.snowboard);t.detach=()=>this.instances.splice(this.instances.indexOf(t),1),this.instances.push(t)}getDependencies(){return this.isFunction()||"function"!=typeof this.instance.prototype.dependencies?[]:this.instance.prototype.dependencies().map((t=>t.toLowerCase()))}dependenciesFulfilled(){const t=this.getDependencies();let e=!0;return t.forEach((t=>{this.snowboard.hasPlugin(t)||(e=!1)})),e}mock(t,e){var n=this;if(!this.isFunction()){if(!this.instance.prototype[t])throw new Error('Function "'.concat(t,'" does not exist and cannot be mocked'));this.mocks[t]=e,this.originalFunctions[t]=this.instance.prototype[t],this.isSingleton()&&0===this.instances.length&&(this.initialiseSingleton(),this.instances[0][t]=function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return e(n,...i)})}}unmock(t){this.isFunction()||this.mocks[t]&&(this.isSingleton()&&(this.instances[0][t]=this.originalFunctions[t]),delete this.mocks[t],delete this.originalFunctions[t])}}var o=n(26);function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class h extends s{constructor(t){super(t),this.defaults={expires:null,path:"/",domain:null,secure:!1,sameSite:"Lax"}}setDefaults(t){if("object"!=typeof t)throw new Error("Cookie defaults must be provided as an object");Object.entries(t).forEach((t=>{const[e,n]=t;void 0!==this.defaults[e]&&(this.defaults[e]=n)}))}getDefaults(){const t={};return Object.entries(this.defaults).forEach((e=>{const[n,i]=e;null!==this.defaults[n]&&(t[n]=i)})),t}get(t){if(void 0===t){const t=o.Z.get();return Object.entries(t).forEach((e=>{const[n,i]=e;this.snowboard.globalEvent("cookie.get",n,i,(e=>{t[n]=e}))})),t}let e=o.Z.get(t);return this.snowboard.globalEvent("cookie.get",t,e,(t=>{e=t})),e}set(t,e,n){let i=e;return this.snowboard.globalEvent("cookie.set",t,e,(t=>{i=t})),o.Z.set(t,i,l(l({},this.getDefaults()),n))}remove(t,e){o.Z.remove(t,l(l({},this.getDefaults()),e))}}class u extends s{constructor(t){super(t),window.wnJSON=t=>this.parse(t),window.ocJSON=window.wnJSON}parse(t){const e=this.parseString(t);return JSON.parse(e)}parseString(t){let e=t.trim();if(!e.length)throw new Error("Broken JSON object.");let n="",i=null,s=null,r="";for(;e&&","===e[0];)e=e.substr(1);if('"'===e[0]||"'"===e[0]){if(e[e.length-1]!==e[0])throw new Error("Invalid string JSON object.");r='"';for(let t=1;t<e.length;t+=1)if("\\"===e[t])"'"===e[t+1]||(r+=e[t]),r+=e[t+1],t+=1;else{if(e[t]===e[0])return r+='"',r;'"'===e[t]?r+='\\"':r+=e[t]}throw new Error("Invalid string JSON object.")}if("true"===e||"false"===e)return e;if("null"===e)return"null";const o=parseFloat(e);if(!Number.isNaN(o))return o.toString();if("{"===e[0]){i="needKey",s=null,n="{";for(let t=1;t<e.length;t+=1)if(!this.isBlankChar(e[t]))if("needKey"!==i||'"'!==e[t]&&"'"!==e[t]){if("needKey"===i&&this.canBeKeyHead(e[t]))s=this.parseKey(e,t),n+='"',n+=s,n+='"',t+=s.length-1,i="afterKey";else if("afterKey"===i&&":"===e[t])n+=":",i=":";else if(":"===i)r=this.getBody(e,t),t=t+r.originLength-1,n+=this.parseString(r.body),i="afterBody";else if("afterBody"===i||"needKey"===i){let s=t;for(;","===e[s]||this.isBlankChar(e[s]);)s+=1;if("}"===e[s]&&s===e.length-1){for(;","===n[n.length-1];)n=n.substr(0,n.length-1);return n+="}",n}s!==t&&"{"!==n&&(n+=",",i="needKey",t=s-1)}}else s=this.parseKey(e,t+1,e[t]),n+='"'.concat(s,'"'),t+=s.length,t+=1,i="afterKey";throw new Error("Broken JSON object near ".concat(n))}if("["===e[0]){n="[",i="needBody";for(let t=1;t<e.length;t+=1)if(" "!==e[t]&&"\n"!==e[t]&&"\t"!==e[t])if("needBody"===i){if(","===e[t]){n+="null,";continue}if("]"===e[t]&&t===e.length-1)return","===n[n.length-1]&&(n=n.substr(0,n.length-1)),n+="]",n;r=this.getBody(e,t),t=t+r.originLength-1,n+=this.parseString(r.body),i="afterBody"}else if("afterBody"===i)if(","===e[t])for(n+=",",i="needBody";","===e[t+1]||this.isBlankChar(e[t+1]);)","===e[t+1]&&(n+="null,"),t+=1;else if("]"===e[t]&&t===e.length-1)return n+="]",n;throw new Error("Broken JSON array near ".concat(n))}return""}getBody(t,e){let n="";if('"'===t[e]||"'"===t[e]){n=t[e];for(let i=e+1;i<t.length;i+=1)if("\\"===t[i])n+=t[i],i+1<t.length&&(n+=t[i+1]),i+=1;else{if(t[i]===t[e])return n+=t[e],{originLength:n.length,body:n};n+=t[i]}throw new Error("Broken JSON string body near ".concat(n))}if("t"===t[e]){if(t.indexOf("true",e)===e)return{originLength:"true".length,body:"true"};throw new Error("Broken JSON boolean body near ".concat(t.substr(0,e+10)))}if("f"===t[e]){if(t.indexOf("f",e)===e)return{originLength:"false".length,body:"false"};throw new Error("Broken JSON boolean body near ".concat(t.substr(0,e+10)))}if("n"===t[e]){if(t.indexOf("null",e)===e)return{originLength:"null".length,body:"null"};throw new Error("Broken JSON boolean body near ".concat(t.substr(0,e+10)))}if("-"===t[e]||"+"===t[e]||"."===t[e]||t[e]>="0"&&t[e]<="9"){n="";for(let i=e;i<t.length;i+=1){if(!("-"===t[i]||"+"===t[i]||"."===t[i]||t[i]>="0"&&t[i]<="9"))return{originLength:n.length,body:n};n+=t[i]}throw new Error("Broken JSON number body near ".concat(n))}if("{"===t[e]||"["===t[e]){const i=[t[e]];n=t[e];for(let s=e+1;s<t.length;s+=1){if(n+=t[s],"\\"===t[s])s+1<t.length&&(n+=t[s+1]),s+=1;else if('"'===t[s])'"'===i[i.length-1]?i.pop():"'"!==i[i.length-1]&&i.push(t[s]);else if("'"===t[s])"'"===i[i.length-1]?i.pop():'"'!==i[i.length-1]&&i.push(t[s]);else if('"'!==i[i.length-1]&&"'"!==i[i.length-1])if("{"===t[s])i.push("{");else if("}"===t[s]){if("{"!==i[i.length-1])throw new Error("Broken JSON ".concat("{"===t[e]?"object":"array"," body near ").concat(n));i.pop()}else if("["===t[s])i.push("[");else if("]"===t[s]){if("["!==i[i.length-1])throw new Error("Broken JSON ".concat("{"===t[e]?"object":"array"," body near ").concat(n));i.pop()}if(!i.length)return{originLength:s-e,body:n}}throw new Error("Broken JSON ".concat("{"===t[e]?"object":"array"," body near ").concat(n))}throw new Error("Broken JSON body near ".concat(t.substr(e-5>=0?e-5:0,50)))}parseKey(t,e,n){let i="";for(let s=e;s<t.length;s+=1){if(n&&n===t[s])return i;if(!n&&(" "===t[s]||":"===t[s]))return i;i+=t[s],"\\"===t[s]&&s+1<t.length&&(i+=t[s+1],s+=1)}throw new Error("Broken JSON syntax near ".concat(i))}canBeKeyHead(t){return"\\"!==t[0]&&(t[0]>="a"&&t[0]<="z"||t[0]>="A"&&t[0]<="Z"||"_"===t[0]||(t[0]>="0"&&t[0]<="9"||("$"===t[0]||t.charCodeAt(0)>255)))}isBlankChar(t){return" "===t||"\n"===t||"\t"===t}}class g extends s{constructor(t){super(t),window.wnSanitize=t=>this.sanitize(t),window.ocSanitize=window.wnSanitize}sanitize(t,e){const n=(new DOMParser).parseFromString(t,"text/html"),i=void 0===e||"boolean"!=typeof e||e;return this.sanitizeNode(n.getRootNode()),i?n.body.innerHTML:n.innerHTML}sanitizeNode(t){if("SCRIPT"===t.tagName)return void t.remove();this.trimAttributes(t);Array.from(t.children).forEach((t=>{this.sanitizeNode(t)}))}trimAttributes(t){if(t.attributes)for(let e=0;e<t.attributes.length;e+=1){const n=t.attributes.item(e).name,i=t.attributes.item(e).value;0!==n.indexOf("on")&&0!==i.indexOf("javascript:")||t.removeAttribute(n)}}}class f{constructor(t,e){this.debugEnabled="boolean"==typeof e&&!0===e,this.autoInitSingletons="boolean"==typeof t&&!1===t,this.plugins={},this.attachAbstracts(),this.loadUtilities(),this.initialise(),this.debug("Snowboard framework initialised")}attachAbstracts(){this.PluginBase=i,this.Singleton=s}loadUtilities(){this.addPlugin("cookie",h),this.addPlugin("jsonParser",u),this.addPlugin("sanitizer",g)}initialise(){window.addEventListener("DOMContentLoaded",(()=>{this.autoInitSingletons&&this.initialiseSingletons(),this.globalEvent("ready")}))}initialiseSingletons(){Object.values(this.plugins).forEach((t=>{t.isSingleton()&&t.initialiseSingleton()}))}addPlugin(t,e){var n=this;const s=t.toLowerCase();if(this.hasPlugin(s))throw new Error('A plugin called "'.concat(t,'" is already registered.'));if("function"!=typeof e&&e instanceof i==!1)throw new Error("The provided plugin must extend the PluginBase class, or must be a callback function.");if(void 0!==this[t]||void 0!==this[s])throw new Error("The given name is already in use for a property or method of the Snowboard class.");this.plugins[s]=new r(s,this,e);const o=function(){return n.plugins[s].getInstance(...arguments)};this[t]=o,this[s]=o,this.debug('Plugin "'.concat(t,'" registered'))}removePlugin(t){const e=t.toLowerCase();this.hasPlugin(e)?(this.plugins[e].getInstances().forEach((t=>{t.destructor()})),delete this.plugins[e],delete this[e],this.debug('Plugin "'.concat(t,'" removed'))):this.debug('Plugin "'.concat(t,'" already removed'))}hasPlugin(t){const e=t.toLowerCase();return void 0!==this.plugins[e]}getPlugins(){return this.plugins}getPluginNames(){return Object.keys(this.plugins)}getPlugin(t){if(!this.hasPlugin(t))throw new Error('No plugin called "'.concat(t,'" has been registered.'));return this.plugins[t]}listensToEvent(t){const e=[];return Object.entries(this.plugins).forEach((n=>{const[i,s]=n;if(s.isFunction())return;if(!s.hasMethod("listens"))return;"string"==typeof s.callMethod("listens")[t]&&e.push(i)})),e}globalEvent(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.debug('Calling global event "'.concat(t,'"'));const s=this.listensToEvent(t);if(0===s.length)return this.debug('No listeners found for global event "'.concat(t,'"')),!0;this.debug('Listeners found for global event "'.concat(t,'": ').concat(s.join(", ")));let r=!1;return s.forEach((e=>{const i=this.getPlugin(e);if(i.isFunction())return;i.isSingleton()&&0===i.getInstances().length&&i.initialiseSingleton();const s=i.callMethod("listens")[t];i.getInstances().forEach((i=>{if(!r){if(!i[s])throw new Error('Missing "'.concat(s,'" method in "').concat(e,'" plugin'));!1===i[s](...n)&&(r=!0,this.debug('Global event "'.concat(t,'" cancelled by "').concat(e,'" plugin')))}}))})),!r}globalPromiseEvent(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.debug('Calling global promise event "'.concat(t,'"'));const s=this.listensToEvent(t);if(0===s.length)return this.debug('No listeners found for global promise event "'.concat(t,'"')),Promise.resolve();this.debug('Listeners found for global promise event "'.concat(t,'": ').concat(s.join(", ")));const r=[];return s.forEach((e=>{const i=this.getPlugin(e);if(i.isFunction())return;i.isSingleton()&&0===i.getInstances().length&&i.initialiseSingleton();const s=i.callMethod("listens")[t];i.getInstances().forEach((t=>{const e=t[s](...n);e instanceof Promise!=!1&&r.push(e)}))})),0===r.length?Promise.resolve():Promise.all(r)}debug(){if(this.debugEnabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.groupCollapsed("%c[Snowboard]","color: rgb(45, 167, 199); font-weight: normal;",...e),console.trace(),console.groupEnd()}}}},7674:function(t,e,n){var i=n(3672);(t=>{const e=new i.Z(!0,!0);t.snowboard=e,t.Snowboard=e,t.SnowBoard=e})(window)}},function(t){t.O(0,[649],(function(){return e=7674,t(t.s=e);var e}));t.O()}]);